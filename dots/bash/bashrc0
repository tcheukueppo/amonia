#!/usr/bin/env sh
#########################
#### tcheukueppo's bashrc

####################
### aliases
####################
alias t='tmux'
alias ta='tmux attach'
alias td='tmux detach'
alias ett='/tmp/test.sh'
alias ll='ls --color=auto -lA'
alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'
alias got="history | sed -n 's/^ *[0-9]\+\(.*\)/\1/p' | grep 'cd \+[/~]' | sort -u | fzf | sh"

####################
### envar def
####################
PS3='>>> '
PS2='>> '
PS1='\[\e[1;32m(\#\e[0m\]\[\e[1;34m,\e[0m\]\[\e[1;36m\j)\e[0m\] \u\[\e[1;35m@\e[0m\]\h \[\e[1;31m\W\e[0m\] $ '
HISTCONTROL=ignoreboth
HISTSIZE=1000000
HISTFILESIZE=10000000
EDITOR="${EDITOR:-/bin/vim}"

shopt -s checkwinsize

####################
### functions
####################
makeft() {
	local intr=sh
	local tmpf=/tmp/test

	[ $# -eq 1 ] && intr="$1"
	truncate -s0 $tmpf && chmod u+x $tmpf
	printf '#!/usr/bin/env %s' "$intr" > $tmpf
	eval $EDITOR $tmpf
}

adpath() {
	local nwpath="$1"

	if echo "$PATH" | grep -v ":\?${nwpath%%/}/\?\(:\|$\)"; then
		PATH="${PATH:+$PATH:}$nwpath" && export PATH
	fi
}

stmux() {
	local i=1
	local numb=0
	local targt=0

	if tmux list-sessions &>/dev/null; then
		numb=$(tmux list-sessions | wc -l)
		printf 'Choose a session to attach\n'
		tmux list-sessions | while read line; do
			printf '%s) %s\n' $i "$line"
			((i++))
		done
	fi
	printf 'Enter the name of your new session\n'
	read ans
	if [ -z "$ans" ]; then
		tmux new-session
	elif echo "$ans" | grep -q '^[0-9]\+$'; then
		if [ $ans -ge 1 ] && [ $ans -le $numb ]; then
			targt="$(tmux list-sessions -F'#S' | sed -n "${ans}p")"
			tmux attach -t "$targt"
		fi
	else
		tmux new-session -s "$ans"
	fi
}

####################
### function call
####################
## add local bin to PATH var
adpath "$HOME/.local/bin"
## use tmux on every terminal
if [ -z "$TMUX" ]; then
	command -v tmux &>/dev/null && stmux
fi
